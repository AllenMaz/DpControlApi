
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <environment names="Development">
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-table/dist/bootstrap-table.css" />

        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="~/lib/bootstrap-table/dist/bootstrap-table.min.js"></script>
        <script src="~/lib/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
    </environment>
    <environment names="Staging,Production">
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css"
              asp-fallback-href="~/lib/bootstrap/dist/css/bootstrap.min.css"
              asp-fallback-test-class="sr-only" asp-fallback-test-property="position" asp-fallback-test-value="absolute" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.min.css">

        <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.min.js"></script>
        <script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/locale/bootstrap-table-zh-CN.min.js"></script>
    </environment>

    <script src="~/lib/knockout/dist/knockout.js"></script>
    <script src="~/lib/layer/layer.js"></script>


</head>
<body>

    <div class="container">
        <div class="panel-group" id="divSearch">
            <div class="panel panel-danger">
                <div>
                    <div style="float:left;">
                        <form class="form-horizontal" role="form">
                            <div class="form-group has-success">
                                <label class="col-sm-1 control-label text-right fa-align-center">Name</label>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control" id="name">
                                </div>

                                <label class="col-sm-3 control-label text-right">NormalizedName</label>
                                <div class="col-sm-4">
                                    <input type="text" class="form-control" id="normalizedName">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div style="float:right;">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#divSearch"
                                   href="#divAdvancedSearch" class="glyphicon glyphicon-chevron-up">
                                    高级检索
                                </a>
                            </h4>
                        </div>
                    </div>
                    <div style="clear:both;"></div>

                </div>

                <div id="divAdvancedSearch" class="panel-collapse collapse">
                    <div class="panel-body">
                        添加其余查询条件
                    </div>
                </div>
            </div>
        </div>
        <div id="toolbar">
            <button id="btnAdd" class="btn btn-primary">
                <i class="glyphicon glyphicon-plus"></i>Add
            </button>
            <button id="btnEdit" class="btn btn-success">
                <i class="glyphicon glyphicon-plus"></i>Edit
            </button>
            <button id="btnDelete" class="btn btn-danger">
                <i class="glyphicon glyphicon-remove"></i> Delete
            </button>

        </div>
        <table id="table"></table>
    </div>

</body>
</html>
<!--Script要放在HTML标签后，才能将值绑定到标签-->
<script type="text/javascript">

    $(document).ready(function () {
        InitTable();
        InitToolBarButton();
    });



    function InitTable() {
        $('#table').bootstrapTable({
            height: 500,
            method: 'post',                 //The method type to request remote data.
            url: '/Manage/GetRolePageData',
            dataType: "json",               //The type of data that you are expecting back from the server.
            contentType: 'application/json',
            pagination: true,               //True to show a pagination toolbar on table bottom.
            pageSize: 10,                   //初始化每页显示几条
            pageNumber: 1,                   //初始化在第几页
            pageList: [10, 25, 50, 100, 200, 'All'],
            sidePagination: "server",       //服务端请求
            idField: 'Id',
            toolbar: '#toolbar',
            showRefresh: true,
            search: true,
            queryParams: ConstructQueryParams,
            // queryParamsType: "limit",
            locale: 'en-US',
            columns: [{
                checkbox: true
            },
            {
                field: 'Id',
                title: 'Id',
                visible: false
            },
            {
                field: 'Name',
                title: 'Name'
            },
            {
                field: 'NormalizedName',
                title: 'NormalizedName'
            }
            ]
        });
    }

    function ConstructQueryParams(param) {
        var params = {
            limit: param.limit, //页面大小
            offset: param.offset,//偏移数量
            page: param.offset / param.limit, //页码

        };
        return params;
    }

    function InitToolBarButton() {
        $("#btnAdd").click(function () {
            location.href = "/Manage/CreateRole";
        });

        $("#btnEdit").click(function () {
            layer.alert("Edit is not enabled", {
                skin: 'layui-layer-molv'
                           , closeBtn: 0
                           , shift: 5 //动画类型
            });
        });

        $("#btnDelete").click(function () {

            var selections = $('#table').bootstrapTable('getSelections');
            if (selections.length == 0) {
                layer.alert("Please select records", {
                    skin: 'layui-layer-molv'
                            , closeBtn: 0
                            , shift: 5 //动画类型
                });
                return;
            }

            var roleIds = [];
            for (var i = 0; i < selections.length; i++) {
                var id = selections[i].Id;
                roleIds.push(id);
            }
            //delete records
            var jsonRoleIds = JSON.stringify(roleIds);
            $.ajax({
                type: "get",//使用get方法访问后台
                dataType: "json",//返回json格式的数据
                url: "/Manage/BachDeleteByRoleId",
                data: { "RoleIds": jsonRoleIds },
                async: false,
                success: function (message) {
                    if (message.Success) {
                        //重新加载
                        $('#table').bootstrapTable('refresh');
                    } else {

                        layer.alert(message.Content, {
                            skin: 'layui-layer-lan'
                            , closeBtn: 0
                            , shift: 4 //动画类型
                        });

                    }

                }
            });
        });
    }

</script>
